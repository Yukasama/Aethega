{% extends "home/index.html" %}

{% block content %}
{% load static %}

<link rel="stylesheet" href="{% static 'eye/css/symbol.css' %}">


<div class="stocks flex">

  <div class="sidebar flex">
    <div class="side_link flex active">
      <i class="fa-solid fa-house side_icon"></i>
      <p class="side_text">Dashboard</p>
    </div>
    <div class="side_link flex">
      <i class="fa-solid fa-chart-line side_icon"></i>
      <p class="side_text">Chart</p>
    </div>
    <div class="side_link flex">
      <i class="fa-solid fa-coins side_icon"></i>
      <p class="side_text">Earnings</p>
    </div>
    <div class="side_link flex">
      <i class="fa-solid fa-chart-simple side_icon"></i>
      <p class="side_text">Financials</p>
    </div>
    <div class="side_link flex">
      <i class="fa-solid fa-scale-balanced side_icon"></i>
      <p class="side_text">Holdings</p>
    </div>
    <div class="side_link flex">
      <i class="fa-solid fa-newspaper side_icon"></i>
      <p class="side_text">Articles</p>
    </div>
  </div>

  <div class="stock_window">
    <div class="stock_view stock_view1 active grid_system">
      <div class="stock_title stock_view_item flex">
        <div class="stock_logo smart_box">
          <img class="stock_img" src={{logo}}>
        </div>
        <div class="stock_title_c flex">
          <div class="stock_title_data">
            <p class="stock_title_text">{{name}}</p>
            <p class="stock_title_desc">Company</p>
          </div>
          <div class="stock_title_data">
            <p class="stock_title_text">$149.34</p>
            <p class="stock_title_desc">Price</p>
          </div>
          <div class="stock_title_data">
            <p class="stock_title_text">+0.98%</p>
            <p class="stock_title_desc">Percent</p>
          </div>
          <div class="stock_title_data">
            <p class="stock_title_text">{{eps2021}}</p>
            <p class="stock_title_desc">EPS</p>
          </div>
          <div class="stock_title_data">
            <p class="stock_title_text">{{peRatio2021}}</p>
            <p class="stock_title_desc">P/E Ratio</p>
          </div>
        </div>
      </div>
  
      <div class="stock_chart stock_view_item flex">
        <div class="tradingview-widget-container">
          <div id="tradingview_96d90"></div>
          <div class="tradingview-widget-copyright">
            <a href="https://de.tradingview.com/symbols/{{ticker}}/" rel="noopener" target="_blank">
              <span class="blue-text">{{ticker}} Chart</span></a> from TradingView</div>
          <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
          <script type="text/javascript">
          new TradingView.widget({
          "width": 900, "height": 500,
          "symbol": "{{ticker}}",
          "interval": "D",
          "timezone": "Etc/UTC",
          "theme": "{{mode}}",
          "style": "1",
          "locale": "de_DE",
          "toolbar_bg": "#f1f3f6",
          "enable_publishing": false,
          "allow_symbol_change": true,
          "container_id": "tradingview_96d90"});
          </script>
        </div>
      </div>

      <div class="stock_ratings stock_view_item">
        <p class="stock_header">Ratings</p>
        <div class="stock_ratings_c">
          <div class="stock_rating">
            <p class="stock_rating_text">TA-R</p>
            <p class="stock_rating_text">0.99</p>
          </div>
        </div>
      </div>

      <div class="stock_suggestions stock_view_item">
        <p class="stock_header stock_suggest_header">Industry Competitors</p>
        {% for c in competitors %}
        <div class="stock_suggest flex">
          <div class="stock_logo stock_logo_s smart_box">
            <img class="stock_img_s" src={{c.logo}}>
          </div>
          <div class="stock_suggest_info flex">
            <a href="{% url 'symbol' c.ticker %}" class="stock_name_s">{{c.name}}</a>
            <div class="stock_suggest_data flex">
              <div class="stock_price_s">1500.00$</div>
              <div class="stock_percent_s">+1.59%</div>
            </div>
          </div>
        </div>
        {% empty %}
        <p>No Competitors available.</p>
        {% endfor %}
      </div>

      <div class="stock_charts flex">
        <div class="stock_margins stock_chart_item stock_view_item">
          <p class="stock_header">Margins</p>
          <div class="info flex">
            <i class="fa-solid fa-question info_icon"></i>
            <div class="flex">Margins give an Overview of how efficient a company runs it's operations</div>
            <div></div>
          </div>
          <canvas class="stock_margins_chart"></canvas>
        </div>

        <div class="stock_metrics stock_chart_item stock_view_item">
          <p class="stock_header">Key Metrics</p>
          <div class="info flex">
            <i class="fa-solid fa-question info_icon"></i>
            <div class="flex">Margins give an Overview of how efficient a company runs it's operations</div>
            <div></div>
          </div>
          <canvas class="stock_metrics_chart"></canvas>
        </div>

        <div class="stock_dividend stock_chart_item stock_view_item">
          <p class="stock_header">Dividend</p>
          <div class="info flex">
            <i class="fa-solid fa-question info_icon"></i>
            <div class="flex">Margins give an Overview of how efficient a company runs it's operations</div>
            <div></div>
          </div>
          <canvas class="stock_dividend_chart"></canvas>
        </div>
      </div>

      <div class="stock_financials stock_view_item">
        <p class="stock_header">Financials</p>
      </div>
    </div>




    <div class="stock_view stock_view2 grid_system">
      <div class="stock_chart stock_view_item flex">
        <div class="tradingview-widget-container">
          <div id="tradingview_79edc"></div>
          <div class="tradingview-widget-copyright"><a href="https://de.tradingview.com/symbols/NASDAQ-AAPL/" rel="noopener" target="_blank"><span class="blue-text">AAPL Chart</span></a> von TradingView</div>
          <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
          <script type="text/javascript">
          new TradingView.widget({
          "width": 1650, "height": 800, 
          "symbol": "{{ticker}}",
          "interval": "D",
          "timezone": "Etc/UTC",
          "theme": "dark",
          "style": "1",
          "locale": "de_DE",
          "toolbar_bg": "#f1f3f6",
          "enable_publishing": false,
          "allow_symbol_change": true,
          "container_id": "tradingview_79edc"
        }
          );
          </script>
        </div>
      </div>
    </div>




    <div class="stock_view stock_view3 grid_system">
      <p>Stock view 3</p>
    </div>
      
  </div>
</div>


<script>
  const yearLabels = JSON.parse("{{yearLabels|safe}}");
  const grossMargin = JSON.parse("{{grossProfitMargin|safe}}");
  const operatingMargin = JSON.parse("{{operatingProfitMargin|safe}}");
  const profitMargin = JSON.parse("{{netProfitMargin|safe}}");
  const peRatio = JSON.parse("{{peRatio|safe}}");
  const pbRatio = JSON.parse("{{pbRatio|safe}}");
  const pfcfRatio = JSON.parse("{{pfcfRatio|safe}}");
  const dividendYield = JSON.parse("{{dividendYield|safe}}");
  const payoutRatio = JSON.parse("{{payoutRatio|safe}}");

  function chartConfig(args="normal") {
    var config = {
      plugins: { legend: { labels: {
        fontColor: "rgb(255, 255, 255)",
        font: {
          size: 14,
        } } } 
      },
      scales: {
        x: {
          grid: {
            display: false
          },
          align: "end",
        },
        y: {
          grid: {
            display: false
          },
          ticks: {
            beginAtZero: true,
            callback: function(value, index, values) {
              if (args == "pct") { return value * 100 + '%'; } 
              else { return value }
            },
            font: 14,
          }
    } } }
    return config
  }


  const stock_margins_chart = document.querySelector('.stock_margins_chart').getContext('2d');
  const chart1 = new Chart(stock_margins_chart, {
    type: 'bar',
    data: {
      labels: yearLabels,
      datasets: [
      {
        label: "Gross Margin",
        data: grossMargin,
        backgroundColor: "rgb(0, 110, 255)",
      },
      {
        label: "Operating Margin",
        data: operatingMargin,
        backgroundColor: "rgb(255, 0, 0)",
      },
      {
        label: "Profit Margin",
        data: profitMargin,
        backgroundColor: "rgb(0, 180, 40)",
      },
      ],
    },
    options: chartConfig("pct"),
  });

  const stock_metrics_chart = document.querySelector('.stock_metrics_chart').getContext('2d');
  const chart2 = new Chart(stock_metrics_chart, {
    type: 'line',
    data: {
      labels: yearLabels,
      datasets: [
      {
        label: "P/E Ratio",
        data: peRatio,
        backgroundColor: "rgb(255, 0, 0)",
        borderColor: "rgb(255, 0, 0, 0.3)",
      },
      {
        label: "P/B Ratio",
        data: pbRatio,
        backgroundColor: "rgb(110, 255, 0)",
        borderColor: "rgb(110, 255, 0, 0.3)",
      },
      {
        label: "P/FCF Ratio",
        data: pfcfRatio,
        backgroundColor: "rgb(110, 255, 255)",
        borderColor: "rgb(110, 255, 255, 0.3)",

      },
      ],
    },
    options: chartConfig(),
  });

  const dividend_chart = document.querySelector('.stock_dividend_chart').getContext('2d');
  const chart3 = new Chart(dividend_chart, {
    type: 'line',
    data: {
      labels: yearLabels,
      datasets: [
      {
        label: "Dividend in %",
        data: dividendYield,
        backgroundColor: "rgb(255, 179, 0)",
        borderColor: "rgb(255, 179, 0, 0.3)",
      },
      {
        label: "Payout Ratio",
        data: payoutRatio,
        backgroundColor: "rgb(144, 0, 255)",
        borderColor: "rgb(144, 0, 255, 0.4)",
      },
      {
        label: "Profit Margin",
        data: profitMargin,
        backgroundColor: "rgb(0, 237, 213)",
        borderColor: "rgb(0, 237, 213, 0.3)",
      }
      ],
    },
    options: chartConfig("pct"),
  });


</script>





{% endblock %}